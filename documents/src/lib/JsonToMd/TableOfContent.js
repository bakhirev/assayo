const SMILES = [
  null,
  null, // ÐžÐ¢Ð§ÐÐ¢ ÐŸÐž Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ• ÐšÐžÐœÐœÐ˜Ð¢ÐžÐ’
  'ðŸ“ˆ', //   ÐšÐ°Ðº ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¸ Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚?
  null, //     Ð§ÐµÑ€ÐµÐ· Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€
  null, //     Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÑƒ NodeJS
  null, //     Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÑƒ PHP
  null, //     Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÑƒ Python
  null, //     Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÑƒ Ruby
  null, //     Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÑƒ Go
  null, //     Ð‘ÐµÐ· ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐº
  null, //     Ð§ÐµÑ€ÐµÐ· github actions
  null, //     Ð¡ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°
  'â€ðŸŽ­', //   ÐšÐ°Ðº Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒ Ð°Ð²Ñ‚Ð¾Ñ€Ð¾Ð² ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¾Ð² Ð² Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ðµ?
  'ðŸ“¤', //   ÐšÐ°Ðº Ð²Ñ‹Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· git Ð² txt Ñ„Ð°Ð¹Ð»?
  null, //     Ð”Ð»Ñ Ð¾Ð½Ð»Ð°Ð¹Ð½ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð°
  null, //     Ð”Ð»Ñ Ð¾Ñ„Ð»Ð°Ð¹Ð½ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð°
  null, //     Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚Ðµ PowerShell Ð² Windows
  'ðŸ—ƒï¸', //   ÐšÐ°Ðº Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð¿Ð¾ Ð³Ñ€ÑƒÐ¿Ð¿Ðµ Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²?

  null, // Ð•Ð–Ð•Ð”ÐÐ•Ð’ÐÐ«Ð• ÐŸÐ ÐÐšÐ¢Ð˜ÐšÐ˜ Ð’ ÐŸÐ ÐžÐ•ÐšÐ¢Ð•
  'ðŸ“', //   ÐšÐ°Ðº Ð¿Ð¾Ð´Ð¿Ð¸ÑÑ‹Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ñ‹?
  'ðŸ‘®', //   ÐšÐ°Ðº Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÑƒÑŽ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°?
  null, //     Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ñ„Ð°Ð¹Ð» commit-msg
  null, //     Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð¿Ð°ÐºÐµÑ‚ pre-commit

  null, // ÐžÐ‘ Ð­Ð¢ÐžÐœ ÐŸÐ Ð˜Ð›ÐžÐ–Ð•ÐÐ˜Ð˜
  'ðŸŽ¨', //   ÐšÐ°Ðº Ð±Ñ€ÐµÐ½Ð´Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚?
  'ðŸ› ï¸', //   ÐšÐ°Ðº Ð¿ÐµÑ€ÐµÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð» Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð° Ð¸Ð· Ð¸ÑÑ…Ð¾Ð´Ð½Ð¾Ð³Ð¾ ÐºÐ¾Ð´Ð°?
  'ðŸˆ¯', //   ÐšÐ°Ðº Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¸Ð»Ð¸ Ð¾Ñ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´?
  'ðŸ“', //   ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°
  null, //     Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÑÑ‚Ð¾Ð³Ð¾ Ð¼Ð¾Ð´ÑƒÐ»Ñ
  null, //     ÐžÐ±Ñ‰Ð°Ñ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
  'ðŸ“§', //   ÐŸÐ¾Ð¶ÐµÐ»Ð°Ð½Ð¸Ñ, Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, Ð·Ð°Ð¼ÐµÑ‡Ð°Ð½Ð¸Ñ

  null, // 1
  null, // 4
  null, // 8
  null, // 8
  null, // 8
  null, // 9
  null, // 9
  null, // 11
  null, // 12
  null, // 12
  null, // 12
  'ðŸ‘¨â€ðŸ’»', // 12
  'ðŸš€', // 5
  'ðŸ­', // 13
  'ðŸ“š', // 20
  'ðŸ› ï¸', // 27
  'ðŸ—ºï¸', // 30
];

class TableOfContent {
  constructor() {
    this.prefixes = (new Array(6)).fill(1).map((a, i) => (new Array(i)).fill('#').join(''));
    this.smiles = SMILES;
    this.titles = [];
    this.indexOfList = 0;
  }

  addTitle(level, text, markdownText) {
    this.titles.push({ level, text });
    const index = this.titles.length - 1;
    markdownText.push(`<a name="link-${index}"></a>`);
    const prefix = this.prefixes[level] || '';
    const smile = this.smiles[index] || '';
    markdownText.push(`${prefix} ${smile} ${text}`);

    // Ð¼Ð°Ñ€ÐºÐµÑ€, Ð³Ð´Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ
    if (!this.indexOfList && level === 3) {
      this.indexOfList = markdownText.length;
    }
  }

  getMarkdownWithTable(markdownText) {
    const content = this.titles
      .map(({ level, text }, i) => {
        if (!(level === 2 || level === 3 || level === 4) || i === 0) return;
        const prefix = ['\n\n', '  ', '    '][level - 2];
        const title = text.replace(/(\([^)]*\))|([\[\]`]*)/gim, '');
        return `${prefix}- [${title}](#link-${i})`;
      })
      .filter(v => v);

    return [
      ...markdownText.slice(0, this.indexOfList),
      ...content,
      ...markdownText.slice(this.indexOfList),
    ];
  }
}

module.exports = TableOfContent;
